<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>–ö–∞–±–∏–Ω–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --bg-dark: #0f172a;
  --bg-card: rgba(30, 41, 59, 0.6);
  --bg-overlay: rgba(15, 23, 42, 0.85);
  --text-light: #e2e8f0;
  --text-muted: #94a3b8;
  --text-strong: #f1f5f9;
  --accent-blue: #60a5fa;
  --accent-blue-dark: #3b82f6;
  --accent-purple: #a78bfa;
  --accent-green: #6ee7b7;
  --accent-red: #f87171;
  --border: rgba(100, 116, 139, 0.3);
  --shadow: rgba(0, 0, 0, 0.3);
  --glow-blue: rgba(96, 165, 250, 0.4);
  --glow-purple: rgba(167, 139, 250, 0.3);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

body {
  background: linear-gradient(135deg, #0c1445 0%, #0f172a 100%);
  color: var(--text-light);
  padding: 12px;
  min-height: 100vh;
  line-height: 1.5;
  overflow-x: hidden;
}

.container {
  max-width: 768px;
  margin: 0 auto;
  background: var(--bg-card);
  backdrop-filter: blur(12px);
  border-radius: 18px;
  box-shadow: 
    0 8px 32px var(--shadow),
    0 0 20px var(--glow-blue);
  overflow: hidden;
  font-size: 15px;
  position: relative;
  border: 1px solid var(--border);
}

/* Tabs */
.tabs {
  display: flex;
  background: var(--bg-overlay);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(10px);
}
.tab-btn {
  flex: 1;
  padding: 16px 12px;
  background: transparent;
  border: none;
  font-weight: 600;
  color: var(--text-muted);
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  font-size: 0.95rem;
}
.tab-btn::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 50%;
  transform: translateX(-50%) scaleX(0);
  width: 30%;
  height: 2px;
  background: var(--accent-blue);
  transition: transform 0.3s ease;
}
.tab-btn.active {
  color: var(--accent-blue);
}
.tab-btn.active::after {
  transform: translateX(-50%) scaleX(1);
}
.tab-btn:hover:not(.active) {
  color: var(--text-strong);
}

/* Header */
.header {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 20px 18px;
  background: var(--bg-overlay);
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(10px);
}
.avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: #0f172a;
  font-size: 22px;
  flex-shrink: 0;
  box-shadow: 
    0 0 20px var(--glow-blue),
    inset 0 0 10px rgba(255,255,255,0.2);
  backdrop-filter: blur(4px);
}
.info h2 {
  font-size: 1.4rem;
  font-weight: 700;
  margin-bottom: 4px;
  background: linear-gradient(to right, #cbd5e1, #e2e8f0);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
}
.info p {
  font-size: 1rem;
  color: var(--text-muted);
}

/* Plan Box */
.plan-box {
  padding: 20px 18px;
  background: var(--bg-overlay);
  margin: 18px;
  border-radius: 16px;
  position: relative;
  border: 1px solid var(--border);
  backdrop-filter: blur(10px);
}
.plan-title {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--accent-blue);
}
.progress-container {
  height: 16px;
  background: rgba(68, 68, 68, 0.6);
  border-radius: 8px;
  overflow: hidden;
  margin: 8px 0;
  border: 1px solid rgba(100, 100, 100, 0.4);
  position: relative;
  box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.5);
}
.progress-fill {
  height: 100%;
  border-radius: 8px;
  /* –ü–µ—Ä–µ–ª–∏–≤–∞—é—â–∏–π—Å—è –≥—Ä–∞–¥–∏–µ–Ω—Ç */
  background: linear-gradient(
    90deg,
    #60a5fa 0%,
    #818cf8 30%,
    #a78bfa 60%,
    #c084fc 100%
  );
  background-size: 300% 100%;
  animation: glowPulse 4s ease-in-out infinite;
  /* –ü–ª–∞–≤–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
  transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.6s ease;
  /* –°–≤–µ—á–µ–Ω–∏–µ */
  box-shadow: 
    0 0 12px rgba(96, 165, 250, 0.5),
    0 0 20px rgba(167, 139, 250, 0.3);
  position: relative;
}
.progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.4),
    transparent
  );
  background-size: 200% 100%;
  animation: shineWave 3s ease-in-out infinite;
  opacity: 0.7;
  border-radius: 8px;
}
@keyframes glowPulse {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
@keyframes shineWave {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}
/* –ü—Ä–∏ 100% ‚Äî –∑–µ–ª—ë–Ω—ã–π –Ω–µ–æ–Ω */
.progress-fill[data-percentage="100"] {
  background: linear-gradient(
    90deg,
    #6ee7b7 0%,
    #34d399 30%,
    #10b981 60%,
    #059669 100%
  );
  box-shadow: 
    0 0 16px rgba(110, 231, 183, 0.6),
    0 0 24px rgba(110, 231, 183, 0.3);
}
.progress-fill[data-percentage="100"]::after {
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.5),
    transparent
  );
}
.progress-text {
  display: flex;
  justify-content: space-between;
  font-size: 0.95rem;
  font-weight: 500;
  margin-top: 8px;
  color: var(--text-muted);
}
.shift-status {
  font-size: 0.9rem;
  color: var(--text-muted);
  margin-top: 10px;
  font-style: italic;
  opacity: 0.9;
}

/* Section title */
.section-title {
  font-size: 1.3rem;
  font-weight: 600;
  margin: 24px 0 16px;
  padding: 0 18px;
  display: flex;
  align-items: center;
  gap: 10px;
  color: var(--accent-blue);
  text-shadow: 0 0 8px rgba(96, 165, 250, 0.3);
}

/* Form */
.form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
  padding: 0 18px 20px;
}
@media (min-width: 600px) {
  .form-grid {
    grid-template-columns: 1fr 1fr;
  }
}
.form-group {
  margin: 0;
}
label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--text-strong);
}
input, select {
  width: 100%;
  padding: 12px 14px;
  border: 1px solid var(--border);
  border-radius: 12px;
  font-size: 14px;
  background: rgba(15, 23, 42, 0.5);
  color: var(--text-strong);
  transition: all 0.3s ease;
  backdrop-filter: blur(6px);
}
input:focus, select:focus {
  outline: none;
  border-color: var(--accent-blue);
  box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
}

/* Buttons */
.btn-row {
  display: flex;
  gap: 12px;
  padding: 0 18px 20px;
  flex-wrap: wrap;
}
button {
  flex: 1;
  min-width: 130px;
  border: none;
  border-radius: 12px;
  padding: 12px 14px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.17, 0.67, 0.88, 1.01);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(6px);
  background: rgba(30, 41, 59, 0.7);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}
button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transition: 0.5s;
}
button:hover::before {
  left: 100%;
}
button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px var(--glow-blue);
}

/* === –ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π === */
.btn-blue {
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  color: white;
  font-weight: 600;
  border: none;
  border-radius: 12px;
  padding: 12px 16px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.17, 0.67, 0.88, 1.01);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(6px);
  box-shadow: 
    0 4px 16px rgba(96, 165, 250, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.05);
}

.btn-blue:hover {
  transform: translateY(-2px);
  box-shadow: 
    0 6px 20px rgba(96, 165, 250, 0.6),
    0 0 20px var(--glow-blue),
    0 0 0 1px rgba(255, 255, 255, 0.1);
}

/* === –û—Å–æ–±—ã–π —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑" === */
.btn-create {
  animation: pulseGlow 2s infinite;
}

@keyframes pulseGlow {
  0%, 100% { 
    box-shadow: 
      0 4px 16px rgba(96, 165, 250, 0.4),
      0 0 0 1px rgba(255,255,255,0.05); 
  }
  50% { 
    box-shadow: 
      0 4px 16px rgba(96, 165, 250, 0.6),
      0 0 24px var(--glow-blue),
      0 0 0 1px rgba(255,255,255,0.1); 
  }
}

.btn-create:hover {
  animation: none;
  box-shadow: 
    0 8px 24px rgba(167, 139, 250, 0.7),
    0 0 30px var(--glow-purple),
    0 0 0 1px rgba(255,255,255,0.15);
}

/* === –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —è—Ä–∫–∏–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π === */
.btn-action {
  width: 32px;
  height: 32px;
  min-width: auto;
  padding: 0;
  border: none;
  border-radius: 8px;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 2px 6px rgba(96, 165, 250, 0.4);
  margin: 0 2px;
}
.btn-action:hover {
  transform: translateY(-2px) scale(1.1);
  box-shadow: 
    0 4px 10px rgba(96, 165, 250, 0.6),
    0 0 12px var(--glow-blue);
}
.btn-action i {
  font-size: 14px;
  line-height: 1;
}
.btn-view { background: linear-gradient(135deg, #60a5fa, #3b82f6); }
.btn-edit { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
.btn-delete {
  background: linear-gradient(135deg, var(--accent-red), #ef4444);
  box-shadow: 0 2px 6px rgba(248, 113, 113, 0.4);
}
.btn-delete:hover {
  box-shadow: 
    0 4px 10px rgba(248, 113, 113, 0.6),
    0 0 12px rgba(248, 113, 113, 0.4);
}

/* === –ß–∞–µ–≤—ã–µ: –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –±–µ–∑ –∂—ë–ª—Ç–æ–≥–æ === */
#tips-tab .progress-fill {
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)) !important;
  box-shadow: 
    0 0 12px rgba(96, 165, 250, 0.5),
    0 0 20px rgba(167, 139, 250, 0.3) !important;
}

/* Orders list */
.date-label, .preorders-label {
  font-weight: 600;
  color: var(--accent-blue);
  margin: 18px 0 14px;
  padding: 0 18px;
  display: block;
  text-shadow: 0 0 6px rgba(96, 165, 250, 0.2);
}
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  margin: 0 18px 18px;
}
th {
  background: rgba(30, 41, 59, 0.5);
  padding: 12px 10px;
  text-align: left;
  font-weight: 600;
  border-bottom: 1px solid var(--border);
  color: var(--accent-blue);
  backdrop-filter: blur(4px);
}
td {
  padding: 12px 10px;
  border-bottom: 1px solid rgba(100, 116, 139, 0.2);
  color: var(--text-strong);
}
.amount {
  font-weight: 600;
  color: var(--accent-green);
  text-shadow: 0 0 6px rgba(110, 231, 183, 0.3);
}

.empty-msg {
  text-align: center;
  color: var(--text-muted);
  padding: 24px 18px;
  font-style: italic;
  opacity: 0.8;
}

.hint {
  text-align: center;
  margin: 24px 18px;
  padding: 14px;
  color: var(--text-muted);
  font-size: 13px;
  border: 1px dashed var(--border);
  border-radius: 12px;
  background: rgba(30, 41, 59, 0.4);
  backdrop-filter: blur(6px);
}

/* Animations */
.fade-in {
  animation: fadeIn 0.4s ease-out;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.hidden { display: none; }

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(6px);
}
.modal.active {
  display: flex;
}
.modal-content {
  background: var(--bg-card);
  padding: 28px;
  border-radius: 18px;
  max-width: 420px;
  width: 92%;
  box-shadow: 
    0 12px 40px var(--shadow),
    0 0 30px var(--glow-blue);
  border: 1px solid var(--border);
  position: relative;
  backdrop-filter: blur(12px);
}
.modal-title {
  font-size: 1.3rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: var(--accent-blue);
  text-shadow: 0 0 8px rgba(96, 165, 250, 0.3);
}
.modal-row {
  margin-bottom: 20px;
}
.modal-buttons {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

.details-item {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid rgba(100, 116, 139, 0.2);
}
.details-label {
  font-weight: 600;
  color: var(--text-strong);
}
.details-value {
  color: var(--accent-blue);
  font-weight: 500;
}
</style>
</head>
<body>
<div class="container fade-in">
<!-- Tabs -->
<div class="tabs">
<button class="tab-btn active" onclick="switchTab('main')">–û—Å–Ω–æ–≤–Ω–æ–µ</button>
<button class="tab-btn" onclick="switchTab('preorders')">–ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã</button>
<button class="tab-btn" onclick="switchTab('tips')">–ß–∞–µ–≤—ã–µ</button>
</div>

<!-- Main Tab -->
<div id="main-tab">
<!-- Header -->
<div class="header">
<div class="avatar"><i class="fas fa-user"></i></div>
<div class="info">
<h2>–û–ø–µ—Ä–∞—Ç–æ—Ä ‚Ññ<span id="opId">1</span></h2>
<p>–í—Å–µ–≥–æ: <b><span id="totalAll">0.00</span> ‚ÇΩ</b></p>
</div>
</div>

<!-- Plan Box -->
<div class="plan-box">
<div class="plan-title">
<i class="fas fa-bullseye"></i> –ü–ª–∞–Ω: <b>3000 ‚ÇΩ</b>
</div>
<div class="progress-container">
<div class="progress-fill" id="progressFill"></div>
</div>
<div class="progress-text">
<span>–¢–µ–∫—É—â–∞—è —Å–º–µ–Ω–∞:</span>
<span><b><span id="todayEarned">0.00</span> ‚ÇΩ</b></span>
</div>
<div class="shift-status" id="shiftStatus">–°–º–µ–Ω–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞</div>
</div>

<!-- Shift Controls -->
<div class="btn-row">
  <button class="btn-blue" onclick="startShift()">
    <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å —Å–º–µ–Ω—É
  </button>
  <button class="btn-blue" onclick="endShift()">
    <i class="fas fa-stop"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É
  </button>
</div>

<!-- Create Order -->
<div class="section-title">
<i class="fas fa-plus"></i> –ù–æ–≤—ã–π –∑–∞–∫–∞–∑
</div>
<div class="form-grid">
<div class="form-group">
<label>‚Ññ –∑–∞–∫–∞–∑–∞</label>
<input type="text" id="orderNum" placeholder="–ù–∞–ø—Ä.: ORD-001" required>
</div>
<div class="form-group">
<label>–¢–∞—Ä–∏—Ñ</label>
<select id="tariff">
<option value="RASPIL_M2">–†–∞—Å–ø–∏–ª ‚Äî 65 ‚ÇΩ/–º¬≤</option>
<option value="LINEAR_RASPIL">–õ–∏–Ω. —Ä–∞—Å–ø–∏–ª ‚Äî 26 ‚ÇΩ/–º</option>
<option value="SKLEIKA_OB">–°–∫–ª–µ–π–∫–∞ + ‚Äî 210 ‚ÇΩ/–º¬≤</option>
<option value="SKLEIKA_NO_OB">–°–∫–ª–µ–π–∫–∞ ‚Äì ‚Äî 165 ‚ÇΩ/–º¬≤</option>
<option value="PAZY">–ü–∞–∑—ã ‚Äî 30 ‚ÇΩ/–º</option>
<option value="FREZER_FASKA">–§–∞—Å–∫–∞ ‚Äî 16 ‚ÇΩ/–º</option>
<option value="TIME">–í—Ä–µ–º—è ‚Äî 330 ‚ÇΩ/—á</option>
</select>
</div>
<div class="form-group">
<label>–î–µ—Ç–∞–ª—å</label>
<input type="text" id="detail" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
</div>
<div class="form-group">
<label>–ö–æ–ª-–≤–æ</label>
<input type="number" id="qty" value="1" min="1">
</div>
<div class="form-group" id="lengthGroup">
<label>–î–ª–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="length" placeholder="0.00">
</div>
<div class="form-group hidden" id="widthGroup">
<label>–®–∏—Ä–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="width" placeholder="0.00">
</div>
<div class="form-group hidden" id="hoursGroup">
<label>–ß–∞—Å—ã</label>
<input type="number" step="0.1" id="hours" placeholder="0.0">
</div>
</div>

<div class="btn-row">
  <button class="btn-blue btn-create" onclick="createMainOrderWithSound()">
    <i class="fas fa-check"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
  </button>
</div>

<!-- View Orders by Date -->
<div class="section-title">
<i class="fas fa-history"></i> –ó–∞–∫–∞–∑—ã –ø–æ –¥–∞—Ç–µ
</div>
<div class="form-grid">
<div class="form-group">
<label>–î–∞—Ç–∞</label>
<input type="date" id="viewDate" value="">
</div>
</div>
<div class="btn-row">
<button class="btn-blue" onclick="showOrdersByDate()">
<i class="fas fa-eye"></i> –ü–æ–∫–∞–∑–∞—Ç—å
</button>
<button class="btn-outline" onclick="saveOrdersToFile()">
<i class="fas fa-download"></i> –í TXT
</button>
<button class="btn-outline" onclick="saveOrdersToJSON()">
<i class="fas fa-file-code"></i> –í JSON
</button>
</div>
<div id="ordersList"></div>
</div>

<!-- Preorders Tab -->
<div id="preorders-tab" class="hidden">
<div class="section-title">
<i class="fas fa-clock"></i> –ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã
</div>
<div class="form-grid">
<div class="form-group">
<label>‚Ññ –∑–∞–∫–∞–∑–∞</label>
<input type="text" id="preOrderNum" placeholder="–ù–∞–ø—Ä.: PRE-001" required>
</div>
<div class="form-group">
<label>–¢–∞—Ä–∏—Ñ</label>
<select id="preTariff">
<option value="RASPIL_M2">–†–∞—Å–ø–∏–ª ‚Äî 65 ‚ÇΩ/–º¬≤</option>
<option value="LINEAR_RASPIL">–õ–∏–Ω. —Ä–∞—Å–ø–∏–ª ‚Äî 26 ‚ÇΩ/–º</option>
<option value="SKLEIKA_OB">–°–∫–ª–µ–π–∫–∞ + ‚Äî 210 ‚ÇΩ/–º¬≤</option>
<option value="SKLEIKA_NO_OB">–°–∫–ª–µ–π–∫–∞ ‚Äì ‚Äî 165 ‚ÇΩ/–º¬≤</option>
<option value="PAZY">–ü–∞–∑—ã ‚Äî 30 ‚ÇΩ/–º</option>
<option value="FREZER_FASKA">–§–∞—Å–∫–∞ ‚Äî 16 ‚ÇΩ/–º</option>
<option value="TIME">–í—Ä–µ–º—è ‚Äî 330 ‚ÇΩ/—á</option>
</select>
</div>
<div class="form-group">
<label>–î–µ—Ç–∞–ª—å</label>
<input type="text" id="preDetail" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
</div>
<div class="form-group">
<label>–ö–æ–ª-–≤–æ</label>
<input type="number" id="preQty" value="1" min="1">
</div>
<div class="form-group" id="preLengthGroup">
<label>–î–ª–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="preLength" placeholder="0.00">
</div>
<div class="form-group hidden" id="preWidthGroup">
<label>–®–∏—Ä–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="preWidth" placeholder="0.00">
</div>
<div class="form-group hidden" id="preHoursGroup">
<label>–ß–∞—Å—ã</label>
<input type="number" step="0.1" id="preHours" placeholder="0.0">
</div>
</div>
<div class="btn-row">
<button class="btn-blue" onclick="createPreorder()">
<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥–∑–∞–∫–∞–∑
</button>
<button class="btn-outline" onclick="document.getElementById('jsonImportInput').click()">
<i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å TXT/JSON
</button>
</div>
<input type="file" id="jsonImportInput" accept=".txt,.json" style="display: none;" />
<div class="preorders-label">–°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤</div>
<div id="preordersList"></div>
</div>
<div class="hint">
üí° –ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø–ª–∞–Ω. –ù–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–∏–Ω—è—Ç—å¬ª, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω—ã–µ.
</div>
</div>

<!-- Tips Tab -->
<div id="tips-tab" class="hidden">
  <div class="section-title">
    <i class="fas fa-mug-hot"></i> –ß–∞–µ–≤—ã–µ
  </div>

  <div class="form-grid">
    <div class="form-group">
      <label>–°—É–º–º–∞ —á–∞–µ–≤—ã—Ö (‚ÇΩ)</label>
      <input type="number" id="tipAmount" placeholder="–ù–∞–ø—Ä.: 300" min="0" step="1">
    </div>
  </div>

  <div class="btn-row">
    <button class="btn-blue" onclick="addTip()">
      <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —á–∞–µ–≤—ã–µ
    </button>
  </div>

  <!-- Stats Cards -->
  <div style="padding: 0 18px 18px;">
    <!-- Total Packets -->
    <div class="plan-box" style="margin: 18px 0;">
      <div class="plan-title">
        <i class="fas fa-box"></i> –í—Å–µ–≥–æ –ø–∞–∫–µ—Ç–∏–∫–æ–≤
      </div>
      <div class="progress-container">
        <div class="progress-fill" id="totalPacketsFill"></div>
      </div>
      <div class="progress-text">
        <span>–ù–∞–∫–æ–ø–ª–µ–Ω–æ:</span>
        <b><span id="totalPacketsCount">0</span> —à—Ç</b>
      </div>
    </div>

    <!-- Today's Packets -->
    <div class="plan-box" style="margin: 18px 0;">
      <div class="plan-title">
        <i class="fas fa-sun"></i> –°–µ–≥–æ–¥–Ω—è
      </div>
      <div class="progress-container">
        <div class="progress-fill" id="todayPacketsFill"></div>
      </div>
      <div class="progress-text">
        <span>–ó–∞ —Å–µ–≥–æ–¥–Ω—è:</span>
        <b><span id="todayPacketsCount">0</span> —à—Ç</b>
      </div>
    </div>

    <!-- Tea Consumed -->
    <div class="plan-box" style="margin: 18px 0;">
      <div class="plan-title">
        <i class="fas fa-wine-bottle"></i> –í—ã–ø–∏—Ç–æ —á–∞—è
      </div>
      <div class="progress-text" style="margin-top: 12px; font-size: 1.1rem;">
        <b><span id="teaLiters">0.0</span> –ª</b>
        <span style="color: var(--text-muted);">(1 –ø–∞–∫–µ—Ç–∏–∫ = 200 –º–ª)</span>
      </div>
    </div>
  </div>
</div>

<!-- Modals -->
<div id="editModal" class="modal">
<div class="modal-content">
<div class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑</div>
<input type="hidden" id="editOrderId">
<div class="modal-row">
<label>‚Ññ –∑–∞–∫–∞–∑–∞</label>
<input type="text" id="editOrderNum" class="form-control">
</div>
<div class="modal-row">
<label>–î–µ—Ç–∞–ª—å</label>
<input type="text" id="editDetail" class="form-control">
</div>
<div class="modal-row">
<label>–¢–∞—Ä–∏—Ñ</label>
<select id="editTariff" class="form-control">
<option value="RASPIL_M2">–†–∞—Å–ø–∏–ª ‚Äî 65 ‚ÇΩ/–º¬≤</option>
<option value="LINEAR_RASPIL">–õ–∏–Ω. —Ä–∞—Å–ø–∏–ª ‚Äî 26 ‚ÇΩ/–º</option>
<option value="SKLEIKA_OB">–°–∫–ª–µ–π–∫–∞ + ‚Äî 210 ‚ÇΩ/–º¬≤</option>
<option value="SKLEIKA_NO_OB">–°–∫–ª–µ–π–∫–∞ ‚Äì ‚Äî 165 ‚ÇΩ/–º¬≤</option>
<option value="PAZY">–ü–∞–∑—ã ‚Äî 30 ‚ÇΩ/–º</option>
<option value="FREZER_FASKA">–§–∞—Å–∫–∞ ‚Äî 16 ‚ÇΩ/–º</option>
<option value="TIME">–í—Ä–µ–º—è ‚Äî 330 ‚ÇΩ/—á</option>
</select>
</div>
<div class="modal-row">
<label>–ö–æ–ª-–≤–æ</label>
<input type="number" id="editQty" min="1" class="form-control">
</div>
<div class="modal-row" id="editLengthGroup">
<label>–î–ª–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="editLength" class="form-control">
</div>
<div class="modal-row hidden" id="editWidthGroup">
<label>–®–∏—Ä–∏–Ω–∞ (–º)</label>
<input type="number" step="0.01" id="editWidth" class="form-control">
</div>
<div class="modal-row hidden" id="editHoursGroup">
<label>–ß–∞—Å—ã</label>
<input type="number" step="0.1" id="editHours" class="form-control">
</div>
<div class="modal-buttons">
<button class="btn-outline" onclick="closeEditModal()">–û—Ç–º–µ–Ω–∞</button>
<button class="btn-blue" onclick="saveEditedOrder()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>
</div>

<div id="dateModal" class="modal">
<div class="modal-content">
<div class="modal-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –¥–ª—è –∑–∞–∫–∞–∑–∞</div>
<div class="modal-row">
<label>–î–∞—Ç–∞</label>
<input type="date" id="modalDate" class="form-control">
</div>
<div class="modal-buttons">
<button class="btn-outline" onclick="closeDateModal()">–û—Ç–º–µ–Ω–∞</button>
<button class="btn-blue" onclick="confirmDateSelection()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
</div>
</div>
</div>

<div id="detailsModal" class="modal">
<div class="modal-content">
<div class="modal-title">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</div>
<div id="detailsContent"></div>
<div class="modal-buttons">
<button class="btn-outline" onclick="closeDetailsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
</div>
</div>

<script>
// === –§–õ–ê–ì –ó–í–£–ö–ê ===
let soundEnabled = true; // ‚úÖ true = –∑–≤—É–∫ –≤–∫–ª—é—á—ë–Ω, false = –≤—ã–∫–ª—é—á–µ–Ω

// === –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ===
const TARIFFS = {
RASPIL_M2: { price: 65, unit: 'm2' },
LINEAR_RASPIL: { price: 26, unit: 'linear' },
SKLEIKA_OB: { price: 210, unit: 'm2' },
SKLEIKA_NO_OB: { price: 165, unit: 'm2' },
PAZY: { price: 30, unit: 'linear' },
FREZER_FASKA: { price: 16, unit: 'linear' },
TIME: { price: 330, unit: 'time' }
};
const TARIFF_NAMES = {
RASPIL_M2: '–†–∞—Å–ø–∏–ª',
LINEAR_RASPIL: '–õ–∏–Ω. —Ä–∞—Å–ø–∏–ª',
SKLEIKA_OB: '–°–∫–ª–µ–π–∫–∞ +',
SKLEIKA_NO_OB: '–°–∫–ª–µ–π–∫–∞ ‚Äì',
PAZY: '–ü–∞–∑—ã',
FREZER_FASKA: '–§–∞—Å–∫–∞',
TIME: '–í—Ä–µ–º—è'
};
const UNIT_LABELS = {
m2: '–º¬≤',
linear: '–ø–æ–≥. –º',
time: '—á–∞—Å—ã'
};

// === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
let hasNotified1000 = false;
let editingOrder = null;
let pendingPreorderId = null;

// === –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ===
const style = document.createElement('style');
style.textContent = `
@keyframes slideIn {
from { transform: translateX(100%); opacity: 0; }
to { transform: translateX(0); opacity: 1; }
}
@keyframes fadeOut {
from { opacity: 1; }
to { opacity: 0; }
}
`;
document.head.appendChild(style);

// === –ó–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª ===
function playSuccessSound() {
  if (!soundEnabled) return;
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);

    oscillator.type = 'sine';
    oscillator.frequency.value = 800;
    gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);

    oscillator.start(ctx.currentTime);
    oscillator.stop(ctx.currentTime + 0.3);
  } catch (e) {
    console.warn("Audio feedback not supported", e);
  }
}

// === –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ + –∑–≤—É–∫ ===
function createMainOrderWithSound() {
  createMainOrder();
  setTimeout(playSuccessSound, 100);
}

// === –£—Ç–∏–ª–∏—Ç—ã ===
function formatDateYMD(dateStr) {
const [y, m, d] = dateStr.split('-');
return `${d}.${m}.${y}`;
}
function todayYMD() {
return new Date().toISOString().split('T')[0];
}
function loadOrders() {
try {
return JSON.parse(localStorage.getItem('operator_orders') || '[]');
} catch (e) { return []; }
}
function saveOrders(orders) {
localStorage.setItem('operator_orders', JSON.stringify(orders));
}
function loadPreorders() {
try {
return JSON.parse(localStorage.getItem('operator_preorders') || '[]');
} catch (e) { return []; }
}
function savePreorders(preorders) {
localStorage.setItem('operator_preorders', JSON.stringify(preorders));
}
function getCurrentShift() {
try {
return JSON.parse(localStorage.getItem('current_shift') || 'null');
} catch (e) { return null; }
}
function setCurrentShift(shift) {
if (shift === null) {
localStorage.removeItem('current_shift');
} else {
localStorage.setItem('current_shift', JSON.stringify(shift));
}
}

// === –ß–∞–µ–≤—ã–µ: —É—Ç–∏–ª–∏—Ç—ã ===
function loadTipsData() {
  try {
    return JSON.parse(localStorage.getItem('tea_tips_data') || '{}');
  } catch (e) {
    return {};
  }
}
function saveTipsData(data) {
  localStorage.setItem('tea_tips_data', JSON.stringify(data));
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —á–∞–µ–≤—ã—Ö
function updateTipsUI() {
  const data = loadTipsData();
  const today = todayYMD();

  // –í—Å–µ–≥–æ –ø–∞–∫–µ—Ç–∏–∫–æ–≤
  const totalPackets = data.totalPackets || 0;
  const totalProgress = Math.min(100, totalPackets / 1000 * 100); // —à–∫–∞–ª–∞ –¥–æ 1000

  // –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –ø–∞–∫–µ—Ç–∏–∫–∏
  const todayPackets = (data.daily && data.daily[today]) || 0;
  const todayProgress = Math.min(100, todayPackets / 200 * 100); // —à–∫–∞–ª–∞ –¥–æ 200

  // –ß–∞–π –≤ –ª–∏—Ç—Ä–∞—Ö
  const teaLiters = (totalPackets * 0.2).toFixed(1);

  // –û–±–Ω–æ–≤–ª—è–µ–º DOM
  document.getElementById('totalPacketsCount').textContent = totalPackets;
  document.getElementById('todayPacketsCount').textContent = todayPackets;
  document.getElementById('teaLiters').textContent = teaLiters;

  // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã
  document.getElementById('totalPacketsFill').style.width = `${totalProgress}%`;
  document.getElementById('todayPacketsFill').style.width = `${todayProgress}%`;

  // –î–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ–ª–∏–≤–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  document.getElementById('totalPacketsFill').setAttribute('data-percentage', Math.round(totalProgress));
  document.getElementById('todayPacketsFill').setAttribute('data-percentage', Math.round(todayProgress));
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∞–µ–≤—ã—Ö
function addTip() {
  const input = document.getElementById('tipAmount');
  const value = parseFloat(input.value);
  if (!value || value <= 0) {
    alert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É —á–∞–µ–≤—ã—Ö (–±–æ–ª—å—à–µ 0)');
    return;
  }

  const packets = Math.floor(value); // 1 ‚ÇΩ = 1 –ø–∞–∫–µ—Ç–∏–∫
  const today = todayYMD();
  const data = loadTipsData();

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  data.totalPackets = data.totalPackets || 0;
  data.daily = data.daily || {};

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
  data.totalPackets += packets;
  data.daily[today] = (data.daily[today] || 0) + packets;

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
  saveTipsData(data);

  // –°–±—Ä–æ—Å –ø–æ–ª—è
  input.value = '';

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
  updateTipsUI();

  // –ó–≤—É–∫ (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω)
  if (typeof playSuccessSound === 'function') {
    setTimeout(playSuccessSound, 100);
  }

  alert(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${packets} —á–∞–π–Ω—ã—Ö –ø–∞–∫–µ—Ç–∏–∫–æ–≤!`);
}

// === –†–∞—Å—á—ë—Ç —Å—É–º–º—ã ===
function calculateAmount(tariffKey, length, width, hours, qty) {
const tariff = TARIFFS[tariffKey];
if (!tariff) return 0;
let amount = 0;
if (tariff.unit === 'time') {
amount = tariff.price * hours * qty;
} else if (tariff.unit === 'm2') {
amount = tariff.price * length * width * qty;
} else {
amount = tariff.price * length * qty;
}
return Math.round(amount * 100) / 100;
}

// === –†–∞—Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –µ–¥–∏–Ω–∏—Ü ===
function calculateUnits(tariffKey, length, width, hours, qty) {
const tariff = TARIFFS[tariffKey];
if (!tariff) return { value: 0, unit: '' };
let value = 0;
let unit = tariff.unit;
if (tariff.unit === 'time') {
value = hours * qty;
} else if (tariff.unit === 'm2') {
value = length * width * qty;
} else {
value = length * qty;
}
return { value: Math.round(value * 100) / 100, unit: UNIT_LABELS[unit] || unit };
}

// === –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–ª–∞–Ω–∞ ===
function updateUI() {
const orders = loadOrders();
const totalAll = orders.reduce((sum, o) => sum + (parseFloat(o.amount) || 0), 0);
const shift = getCurrentShift();
let currentShiftAmount = 0;
let progressWidth = 0;
let statusText = '–°–º–µ–Ω–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞';

if (shift && shift.active) {
currentShiftAmount = orders
.filter(o => o.shiftId === shift.id)
.reduce((sum, o) => sum + (parseFloat(o.amount) || 0), 0);
progressWidth = Math.min(100, (currentShiftAmount / 3000) * 100);
statusText = '–°–º–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞';
} else if (shift && !shift.active) {
currentShiftAmount = shift.finalAmount || 0;
progressWidth = Math.min(100, (currentShiftAmount / 3000) * 100);
statusText = '–°–º–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
}

document.getElementById('totalAll').textContent = totalAll.toFixed(2);
document.getElementById('todayEarned').textContent = currentShiftAmount.toFixed(2);
const fillEl = document.getElementById('progressFill');
fillEl.style.width = `${progressWidth}%`;
fillEl.setAttribute('data-percentage', Math.round(progressWidth)); // ‚Üê –¥–ª—è –∑–µ–ª—ë–Ω–æ–≥–æ –Ω–µ–æ–Ω–∞ –ø—Ä–∏ 100%
document.getElementById('shiftStatus').textContent = statusText;
}

// === –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–µ–π ===
function updateMainFormFields() {
const tariffSelect = document.getElementById('tariff');
if (!tariffSelect) return;
const tariff = tariffSelect.value;
const w = document.getElementById('widthGroup');
const h = document.getElementById('hoursGroup');
const l = document.getElementById('lengthGroup');
if (w) w.classList.add('hidden');
if (h) h.classList.add('hidden');
if (l) l.classList.remove('hidden');
if (['RASPIL_M2', 'SKLEIKA_OB', 'SKLEIKA_NO_OB'].includes(tariff)) {
if (w) w.classList.remove('hidden');
} else if (tariff === 'TIME') {
if (l) l.classList.add('hidden');
if (h) h.classList.remove('hidden');
}
}
function updatePreorderFormFields() {
const tariffSelect = document.getElementById('preTariff');
if (!tariffSelect) return;
const tariff = tariffSelect.value;
const w = document.getElementById('preWidthGroup');
const h = document.getElementById('preHoursGroup');
const l = document.getElementById('preLengthGroup');
if (w) w.classList.add('hidden');
if (h) h.classList.add('hidden');
if (l) l.classList.remove('hidden');
if (['RASPIL_M2', 'SKLEIKA_OB', 'SKLEIKA_NO_OB'].includes(tariff)) {
if (w) w.classList.remove('hidden');
} else if (tariff === 'TIME') {
if (l) l.classList.add('hidden');
if (h) h.classList.remove('hidden');
}
}

// === Tabs ===
function switchTab(tabName) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.getElementById('main-tab').classList.add('hidden');
  document.getElementById('preorders-tab').classList.add('hidden');
  document.getElementById('tips-tab').classList.add('hidden');

  if (tabName === 'main') {
    document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
    document.getElementById('main-tab').classList.remove('hidden');
    updateUI();
    setTimeout(updateMainFormFields, 50);
  } else if (tabName === 'preorders') {
    document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
    document.getElementById('preorders-tab').classList.remove('hidden');
    renderPreorders();
    setTimeout(updatePreorderFormFields, 50);
  } else if (tabName === 'tips') {
    document.querySelector('.tab-btn:nth-child(3)').classList.add('active');
    document.getElementById('tips-tab').classList.remove('hidden');
    updateTipsUI();
  }
}

// === –°–º–µ–Ω–∞ ===
function startShift() {
const shift = getCurrentShift();
if (shift && shift.active) {
alert('–°–º–µ–Ω–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞!');
return;
}
const newShift = { id: Date.now(), startedAt: new Date().toISOString(), active: true };
setCurrentShift(newShift);
alert('‚úÖ –°–º–µ–Ω–∞ –Ω–∞—á–∞—Ç–∞!');
updateUI();
}
function endShift() {
const shift = getCurrentShift();
if (!shift || !shift.active) {
alert('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω—ã –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è!');
return;
}
const orders = loadOrders();
const finalAmount = orders
.filter(o => o.shiftId === shift.id)
.reduce((sum, o) => sum + (parseFloat(o.amount) || 0), 0);
shift.active = false;
shift.finishedAt = new Date().toISOString();
shift.finalAmount = finalAmount;
setCurrentShift(shift);
alert(`‚úÖ –°–º–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${finalAmount.toFixed(2)} ‚ÇΩ`);
updateUI();
}

// === –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ ===
function deleteOrder(orderId) {
if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?')) {
return;
}
const orders = loadOrders();
const orderIndex = orders.findIndex(o => o.id === orderId);
if (orderIndex === -1) return;
orders.splice(orderIndex, 1);
saveOrders(orders);
const shift = getCurrentShift();
if (shift && shift.active) {
updateUI();
}
showOrdersByDate();
alert('‚úÖ –ó–∞–∫–∞–∑ —É–¥–∞–ª–µ–Ω!');
}
function deletePreorder(preorderId) {
if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–¥–∑–∞–∫–∞–∑?')) {
return;
}
const preorders = loadPreorders();
const preorderIndex = preorders.findIndex(p => p.id === preorderId);
if (preorderIndex === -1) return;
preorders.splice(preorderIndex, 1);
savePreorders(preorders);
renderPreorders();
alert('‚úÖ –ü—Ä–µ–¥–∑–∞–∫–∞–∑ —É–¥–∞–ª–µ–Ω!');
}

// === –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã ===
function openDateModal(preorderId) {
pendingPreorderId = preorderId;
const modalDateInput = document.getElementById('modalDate');
if (modalDateInput) {
modalDateInput.value = todayYMD();
}
document.getElementById('dateModal').classList.add('active');
}
function closeDateModal() {
document.getElementById('dateModal').classList.remove('active');
pendingPreorderId = null;
}
function confirmDateSelection() {
const modalDateInput = document.getElementById('modalDate');
const selectedDate = modalDateInput ? modalDateInput.value : null;
if (!selectedDate) {
alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É');
return;
}
if (pendingPreorderId !== null) {
acceptPreorder(pendingPreorderId, selectedDate);
}
closeDateModal();
}

// === –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ ===
function viewOrderDetails(orderId) {
const orders = loadOrders();
const order = orders.find(o => o.id === orderId);
if (!order) return;
const units = calculateUnits(order.tariff, order.length, order.width, order.hours, order.qty);
const tariffName = TARIFF_NAMES[order.tariff] || order.tariff;
let html = '';
html += `<div class="details-item">
<span class="details-label">‚Ññ –∑–∞–∫–∞–∑–∞:</span>
<span class="details-value">${order.orderNumber}</span>
</div>`;
html += `<div class="details-item">
<span class="details-label">–î–µ—Ç–∞–ª—å:</span>
<span class="details-value">${order.detail}</span>
</div>`;
html += `<div class="details-item">
<span class="details-label">–¢–∞—Ä–∏—Ñ:</span>
<span class="details-value">${tariffName}</span>
</div>`;
html += `<div class="details-item">
<span class="details-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</span>
<span class="details-value">${order.qty}</span>
</div>`;
if (order.length !== null) {
html += `<div class="details-item">
<span class="details-label">–î–ª–∏–Ω–∞:</span>
<span class="details-value">${order.length} –º</span>
</div>`;
}
if (order.width !== null) {
html += `<div class="details-item">
<span class="details-label">–®–∏—Ä–∏–Ω–∞:</span>
<span class="details-value">${order.width} –º</span>
</div>`;
}
if (order.hours !== null) {
html += `<div class="details-item">
<span class="details-label">–ß–∞—Å—ã:</span>
<span class="details-value">${order.hours} —á</span>
</div>`;
}
html += `<div class="details-item">
<span class="details-label">–û–±—ä–µ–º —Ä–∞–±–æ—Ç:</span>
<span class="details-value">${units.value} ${units.unit}</span>
</div>`;
html += `<div class="details-item">
<span class="details-label">–°—É–º–º–∞:</span>
<span class="details-value">${order.amount.toFixed(2)} ‚ÇΩ</span>
</div>`;
document.getElementById('detailsContent').innerHTML = html;
document.getElementById('detailsModal').classList.add('active');
}
function closeDetailsModal() {
document.getElementById('detailsModal').classList.remove('active');
}

// === –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ ===
function openEditModal(orderId) {
const orders = loadOrders();
const order = orders.find(o => o.id === orderId);
if (!order) return;
editingOrder = order;
document.getElementById('editOrderId').value = order.id;
document.getElementById('editOrderNum').value = order.orderNumber;
document.getElementById('editDetail').value = order.detail;
document.getElementById('editTariff').value = order.tariff;
document.getElementById('editQty').value = order.qty;
document.getElementById('editLength').value = order.length || '';
document.getElementById('editWidth').value = order.width || '';
document.getElementById('editHours').value = order.hours || '';
updateEditFormFields();
document.getElementById('editModal').classList.add('active');
}
function closeEditModal() {
document.getElementById('editModal').classList.remove('active');
editingOrder = null;
}
function updateEditFormFields() {
const tariff = document.getElementById('editTariff').value;
const w = document.getElementById('editWidthGroup');
const h = document.getElementById('editHoursGroup');
const l = document.getElementById('editLengthGroup');
w.classList.add('hidden');
h.classList.add('hidden');
l.classList.remove('hidden');
if (['RASPIL_M2', 'SKLEIKA_OB', 'SKLEIKA_NO_OB'].includes(tariff)) {
w.classList.remove('hidden');
} else if (tariff === 'TIME') {
l.classList.add('hidden');
h.classList.remove('hidden');
}
}
function saveEditedOrder() {
if (!editingOrder) return;
const orderId = parseInt(document.getElementById('editOrderId').value);
const num = document.getElementById('editOrderNum').value.trim();
if (!num) {
alert('–£–∫–∞–∂–∏—Ç–µ ‚Ññ –∑–∞–∫–∞–∑–∞');
return;
}
const tariffKey = document.getElementById('editTariff').value;
const detail = document.getElementById('editDetail').value.trim() || '‚Äî';
const qty = parseInt(document.getElementById('editQty').value) || 1;
const length = parseFloat(document.getElementById('editLength').value) || 0;
const width = parseFloat(document.getElementById('editWidth').value) || 0;
const hours = parseFloat(document.getElementById('editHours').value) || 0;
const amount = calculateAmount(tariffKey, length, width, hours, qty);
const orders = loadOrders();
const orderIndex = orders.findIndex(o => o.id === orderId);
if (orderIndex !== -1) {
orders[orderIndex] = {
...orders[orderIndex],
orderNumber: num,
tariff: tariffKey,
detail: detail,
qty: qty,
length: length || null,
width: width || null,
hours: hours || null,
amount: amount
};
saveOrders(orders);
updateUI();
showOrdersByDate();
closeEditModal();
alert('‚úÖ –ó–∞–∫–∞–∑ –æ–±–Ω–æ–≤–ª–µ–Ω!');
}
}

// === –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤ ===
function createMainOrder() {
const num = document.getElementById('orderNum').value.trim();
if (!num) { alert('–£–∫–∞–∂–∏—Ç–µ ‚Ññ –∑–∞–∫–∞–∑–∞'); return; }
const tariffKey = document.getElementById('tariff').value;
const detail = document.getElementById('detail').value.trim() || '‚Äî';
const qty = parseInt(document.getElementById('qty').value) || 1;
const length = parseFloat(document.getElementById('length').value) || 0;
const width = parseFloat(document.getElementById('width').value) || 0;
const hours = parseFloat(document.getElementById('hours').value) || 0;
const amount = calculateAmount(tariffKey, length, width, hours, qty);
const shift = getCurrentShift();
if (!shift || !shift.active) {
alert('‚ö†Ô∏è –ù–∞—á–Ω–∏—Ç–µ —Å–º–µ–Ω—É, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã!');
return;
}
const order = {
id: Date.now(),
orderNumber: num,
tariff: tariffKey,
detail: detail,
qty: qty,
length: length || null,
width: width || null,
hours: hours || null,
amount: amount,
date: todayYMD(),
shiftId: shift.id,
timestamp: new Date().toISOString()
};
const orders = loadOrders();
orders.push(order);
saveOrders(orders);
updateUI();
document.getElementById('orderNum').value = '';
document.getElementById('detail').value = '';
document.getElementById('qty').value = '1';
document.getElementById('length').value = '';
document.getElementById('width').value = '';
document.getElementById('hours').value = '';
updateMainFormFields();
}
function createPreorder() {
const num = document.getElementById('preOrderNum').value.trim();
if (!num) { alert('–£–∫–∞–∂–∏—Ç–µ ‚Ññ –ø—Ä–µ–¥–∑–∞–∫–∞–∑–∞'); return; }
const tariffKey = document.getElementById('preTariff').value;
const detail = document.getElementById('preDetail').value.trim() || '‚Äî';
const qty = parseInt(document.getElementById('preQty').value) || 1;
const length = parseFloat(document.getElementById('preLength').value) || 0;
const width = parseFloat(document.getElementById('preWidth').value) || 0;
const hours = parseFloat(document.getElementById('preHours').value) || 0;
const amount = calculateAmount(tariffKey, length, width, hours, qty);
const preorder = {
id: Date.now(),
orderNumber: num,
tariff: tariffKey,
detail: detail,
qty: qty,
length: length || null,
width: width || null,
hours: hours || null,
amount: amount,
date: todayYMD(),
timestamp: new Date().toISOString()
};
const preorders = loadPreorders();
preorders.push(preorder);
savePreorders(preorders);
alert('‚úÖ –ü—Ä–µ–¥–∑–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
renderPreorders();
document.getElementById('preOrderNum').value = '';
document.getElementById('preDetail').value = '';
document.getElementById('preQty').value = '1';
document.getElementById('preLength').value = '';
document.getElementById('preWidth').value = '';
document.getElementById('preHours').value = '';
updatePreorderFormFields();
}
function acceptPreorder(preorderId, selectedDate = null) {
const preorders = loadPreorders();
const preorderIndex = preorders.findIndex(p => p.id === preorderId);
if (preorderIndex === -1) return;
const preorder = preorders[preorderIndex];
const shift = getCurrentShift();
if (!shift || !shift.active) {
alert('–ù–∞—á–Ω–∏—Ç–µ —Å–º–µ–Ω—É, —á—Ç–æ–±—ã –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–µ–¥–∑–∞–∫–∞–∑!');
return;
}
if (!selectedDate) {
openDateModal(preorderId);
return;
}
const order = {
...preorder,
shiftId: shift.id,
date: selectedDate
};
const orders = loadOrders();
orders.push(order);
saveOrders(orders);
preorders.splice(preorderIndex, 1);
savePreorders(preorders);
alert(`‚úÖ –ü—Ä–µ–¥–∑–∞–∫–∞–∑ "${preorder.orderNumber}" –ø—Ä–∏–Ω—è—Ç –Ω–∞ –¥–∞—Ç—É ${formatDateYMD(selectedDate)}!`);
updateUI();
renderPreorders();
}
function renderPreorders() {
const preorders = loadPreorders();
const container = document.getElementById('preordersList');
if (preorders.length === 0) {
container.innerHTML = '<div class="empty-msg">–ù–µ—Ç –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤</div>';
return;
}
let html = `
<table>
<thead>
<tr>
<th>‚Ññ</th>
<th>–î–µ—Ç–∞–ª—å</th>
<th>–°—É–º–º–∞</th>
<th>–î–µ–π—Å—Ç–≤–∏—è</th>
</tr>
</thead>
<tbody>
`;
preorders.forEach(p => {
html += `
<tr>
<td>${p.orderNumber}</td>
<td>${p.detail}</td>
<td class="amount">${p.amount.toFixed(2)} ‚ÇΩ</td>
<td>
<button class="btn-accept" onclick="acceptPreorder(${p.id})">
<i class="fas fa-check"></i> –ü—Ä–∏–Ω—è—Ç—å
</button>
<button class="btn-delete" onclick="deletePreorder(${p.id})">
<i class="fas fa-trash"></i>
</button>
</td>
</tr>
`;
});
html += '</tbody></table>';
container.innerHTML = html;
}
function showOrdersByDate() {
const dateInput = document.getElementById('viewDate').value;
if (!dateInput) {
alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É');
return;
}
const orders = loadOrders();
const filtered = orders.filter(o => o.date === dateInput);
const formattedDate = formatDateYMD(dateInput);
let html = `<div class="date-label">–ó–∞–∫–∞–∑—ã –∑–∞ ${formattedDate}</div>`;
if (filtered.length === 0) {
html += '<div class="empty-msg">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –∑–∞ —ç—Ç—É –¥–∞—Ç—É</div>';
} else {
html += `
<table>
<thead>
<tr>
<th>‚Ññ</th>
<th>–î–µ—Ç–∞–ª—å</th>
<th>–°—É–º–º–∞</th>
<th>–î–µ–π—Å—Ç–≤–∏—è</th>
</tr>
</thead>
<tbody>
`;
filtered.forEach(o => {
html += `
<tr>
<td>${o.orderNumber}</td>
<td>${o.detail}</td>
<td class="amount">${o.amount.toFixed(2)} ‚ÇΩ</td>
<td>
  <button class="btn-action btn-view" onclick="viewOrderDetails(${o.id})">
    <i class="fas fa-eye"></i>
  </button>
  <button class="btn-action btn-edit" onclick="openEditModal(${o.id})">
    <i class="fas fa-edit"></i>
  </button>
  <button class="btn-action btn-delete" onclick="deleteOrder(${o.id})">
    <i class="fas fa-trash"></i>
  </button>
</td>
</tr>
`;
});
html += '</tbody></table>';
}
document.getElementById('ordersList').innerHTML = html;
}
function saveOrdersToFile() {
const dateInput = document.getElementById('viewDate').value;
if (!dateInput) {
alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É');
return;
}
const orders = loadOrders();
const filtered = orders.filter(o => o.date === dateInput);
if (filtered.length === 0) {
alert('–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –∑–∞ —ç—Ç—É –¥–∞—Ç—É');
return;
}
const formattedDate = formatDateYMD(dateInput);
let content = `–ó–ê–ö–ê–ó–´ –ó–ê ${formattedDate}
`;
content += `========================
`;
let totalSum = 0;
let totalM2 = 0;
let totalLinear = 0;
let totalTime = 0;
filtered.forEach((o, idx) => {
const tariffName = TARIFF_NAMES[o.tariff] || o.tariff;
const units = calculateUnits(o.tariff, o.length, o.width, o.hours, o.qty);
content += `‚Ññ${idx + 1}. ${o.orderNumber}
`;
content += `   ${o.detail} (${tariffName})
`;
if (o.length) content += `   –î–ª–∏–Ω–∞: ${o.length} –º
`;
if (o.width) content += `   –®–∏—Ä–∏–Ω–∞: ${o.width} –º
`;
if (o.hours) content += `   –ß–∞—Å—ã: ${o.hours} —á
`;
content += `   –ö–æ–ª-–≤–æ: ${o.qty}
`;
content += `   –û–±—ä–µ–º: ${units.value} ${units.unit}
`;
content += `   –°—É–º–º–∞: ${o.amount.toFixed(2)} ‚ÇΩ
---
`;
totalSum += o.amount;
if (units.unit === '–º¬≤') {
totalM2 += units.value;
} else if (units.unit === '–ø–æ–≥. –º') {
totalLinear += units.value;
} else if (units.unit === '—á–∞—Å—ã') {
totalTime += units.value;
}
});
content += `
–ò–¢–û–ì–û: ${totalSum.toFixed(2)} ‚ÇΩ
`;
if (totalM2 > 0) content += `–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å: ${totalM2.toFixed(2)} –º¬≤
`;
if (totalLinear > 0) content += `–û–±—â–∞—è –¥–ª–∏–Ω–∞: ${totalLinear.toFixed(2)} –ø–æ–≥. –º
`;
if (totalTime > 0) content += `–û–±—â–µ–µ –≤—Ä–µ–º—è: ${totalTime.toFixed(1)} —á
`;
content += `
–≠–∫—Å–ø–æ—Ä—Ç: ${new Date().toLocaleString('ru-RU')}`;
const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
const blob = new Blob([bom, content], { type: 'text/plain;charset=utf-8' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `–∑–∞–∫–∞–∑—ã_${formattedDate}.txt`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
}
function saveOrdersToJSON() {
const dateInput = document.getElementById('viewDate').value;
if (!dateInput) {
alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É');
return;
}
const orders = loadOrders();
const filtered = orders.filter(o => o.date === dateInput);
if (filtered.length === 0) {
alert('–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –∑–∞ —ç—Ç—É –¥–∞—Ç—É');
return;
}
const jsonContent = JSON.stringify(filtered, null, 2);
const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `–∑–∞–∫–∞–∑—ã_${formatDateYMD(dateInput)}.json`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
}

// === –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤ ===
document.getElementById('jsonImportInput').addEventListener('change', function(e) {
const file = e.target.files[0];
if (!file) return;
const reader = new FileReader();
reader.onload = function(event) {
try {
const content = event.target.result;
let importedOrders = [];
if (content.trim().startsWith('{') || content.trim().startsWith('[')) {
importedOrders = JSON.parse(content);
if (!Array.isArray(importedOrders)) {
importedOrders = [importedOrders];
}
} else {
importedOrders = parseTxtOrders(content);
}
if (importedOrders.length === 0) {
alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã –≤ —Ñ–∞–π–ª–µ!');
return;
}
const preorders = loadPreorders();
const newPreorders = importedOrders.map(item => ({
id: Date.now() + Math.random(),
orderNumber: item.orderNumber || '–ò–ú–ü-' + (preorders.length + 1),
tariff: item.tariff || 'RASPIL_M2',
detail: item.detail || '‚Äî',
qty: item.qty || 1,
length: item.length || null,
width: item.width || null,
hours: item.hours || null,
amount: typeof item.amount === 'number' ? item.amount : calculateAmount(
item.tariff || 'RASPIL_M2',
item.length || 0,
item.width || 0,
item.hours || 0,
item.qty || 1
),
date: todayYMD(),
timestamp: new Date().toISOString()
}));
const updated = [...preorders, ...newPreorders];
savePreorders(updated);
renderPreorders();
alert(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${newPreorders.length} –ø—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤!`);
} catch (err) {
console.error(err);
alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:\n' + err.message);
}
};
reader.readAsText(file, 'utf-8');
});

// === –ü–∞—Ä—Å–∏–Ω–≥ TXT ===
function parseTxtOrders(txtContent) {
const orders = [];
const blocks = txtContent.split('---');
for (const block of blocks) {
const lines = block.trim().split('\n').filter(line => line.trim() !== '');
if (lines.length < 3) continue;
const order = {
orderNumber: '',
detail: '',
tariff: '',
qty: 1,
length: null,
width: null,
hours: null,
amount: 0
};
let currentDetail = '';
let currentTariff = '';
for (const line of lines) {
const cleanLine = line.trim();
if (cleanLine.startsWith('‚Ññ') && cleanLine.includes('.')) {
const match = cleanLine.match(/‚Ññ\d+\.\s*(.+)/);
if (match) order.orderNumber = match[1].trim();
} else if (/^[A-Z0-9]/.test(cleanLine) && !cleanLine.includes(':') && !cleanLine.includes('–°—É–º–º–∞') && !cleanLine.includes('–ò–¢–û–ì–û')) {
if (!order.orderNumber && cleanLine.length > 2) {
order.orderNumber = cleanLine;
}
}
if (cleanLine.includes('(') && cleanLine.includes(')') && !cleanLine.includes('–°—É–º–º–∞')) {
const match = cleanLine.match(/(.+)\s*\((.+)\)/);
if (match) {
currentDetail = match[1].trim();
currentTariff = match[2].trim();
}
}
if (cleanLine.startsWith('–î–ª–∏–Ω–∞:')) {
const match = cleanLine.match(/–î–ª–∏–Ω–∞:\s*([\d.]+)\s*–º/);
if (match) order.length = parseFloat(match[1]);
}
if (cleanLine.startsWith('–®–∏—Ä–∏–Ω–∞:')) {
const match = cleanLine.match(/–®–∏—Ä–∏–Ω–∞:\s*([\d.]+)\s*–º/);
if (match) order.width = parseFloat(match[1]);
}
if (cleanLine.startsWith('–ß–∞—Å—ã:')) {
const match = cleanLine.match(/–ß–∞—Å—ã:\s*([\d.]+)\s*—á/);
if (match) order.hours = parseFloat(match[1]);
}
if (cleanLine.startsWith('–ö–æ–ª-–≤–æ:')) {
const match = cleanLine.match(/–ö–æ–ª-–≤–æ:\s*(\d+)/);
if (match) order.qty = parseInt(match[1]);
}
if (cleanLine.startsWith('–°—É–º–º–∞:')) {
const match = cleanLine.match(/–°—É–º–º–∞:\s*([\d.]+)\s*‚ÇΩ/);
if (match) order.amount = parseFloat(match[1]);
}
}
if (currentTariff) {
const tariffMap = {
'–†–∞—Å–ø–∏–ª': 'RASPIL_M2',
'–õ–∏–Ω. —Ä–∞—Å–ø–∏–ª': 'LINEAR_RASPIL',
'–°–∫–ª–µ–π–∫–∞ +': 'SKLEIKA_OB',
'–°–∫–ª–µ–π–∫–∞ ‚Äì': 'SKLEIKA_NO_OB',
'–ü–∞–∑—ã': 'PAZY',
'–§–∞—Å–∫–∞': 'FREZER_FASKA',
'–í—Ä–µ–º—è': 'TIME'
};
order.tariff = tariffMap[currentTariff] || 'RASPIL_M2';
}
order.detail = currentDetail || '‚Äî';
if (order.orderNumber) {
orders.push(order);
}
}
return orders;
}

// === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
document.addEventListener('DOMContentLoaded', () => {
document.getElementById('viewDate').value = todayYMD();
const mainSelect = document.getElementById('tariff');
const preSelect = document.getElementById('preTariff');
const editTariffSelect = document.getElementById('editTariff');
if (mainSelect) {
mainSelect.addEventListener('change', updateMainFormFields);
updateMainFormFields();
}
if (preSelect) {
preSelect.addEventListener('change', updatePreorderFormFields);
updatePreorderFormFields();
}
if (editTariffSelect) {
editTariffSelect.addEventListener('change', updateEditFormFields);
}
updateUI();
renderPreorders();
});
</script>
</body>
</html>
