<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£—á—ë—Ç –∑–∞–∫–∞–∑–æ–≤</title>
  <style>
    body { background: #f5f5f5; padding: 16px; font-family: Arial; }
    .screen { max-width: 400px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: none; }
    .screen.active { display: block; }
    button { width: 100%; padding: 12px; background: #ffd700; border: none; border-radius: 12px; margin: 8px 0; font-weight: bold; }
    .profile { display: flex; gap: 15px; margin-bottom: 20px; }
    .avatar { width: 60px; height: 60px; background: #eee; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; }
    .info h2 { margin: 0 0 5px 0; }
    .earnings, .today-earnings { text-align: center; margin: 20px 0; }
    .earnings p, .today-earnings p { color: #666; }
    .earnings h1, .today-earnings h2 { font-size: 32px; font-weight: bold; }
  </style>
</head>
<body>

<div class="screen active" id="mainScreen">
  <div class="profile" id="profile">
    <div class="avatar" id="avatarBtn">üë§</div>
    <div class="info">
      <h2>–ê–ª–µ–∫—Å–∞–Ω–¥—Ä</h2>
      <p>folder –æ–ø–µ—Ä–∞—Ç–æ—Ä ‚Ññ1–ï2 352726 030</p>
    </div>
  </div>
  <div class="earnings">
    <p>–∑–∞ –≤—Å–µ –≤—Ä–µ–º—è</p>
    <h1 id="totalEarnings">0‚ÇΩ</h1>
  </div>
  <div class="today-earnings">
    <p>–∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞ —Å–º–µ–Ω—É:</p>
    <h2 id="dailyEarnings">0‚ÇΩ</h2>
  </div>
  <button id="btnOrders">—Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</button>
  <button id="btnShifts">—Å–º–µ–Ω—ã</button>
</div>

<script>
// === –ë–ê–ó–û–í–´–ô –°–ö–†–ò–ü–¢ ‚Äî –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–û –†–ê–ë–û–ß–ò–ô ===

let data =.parse(localStorage.getItem('ordersData')) || { orders: [] };

function saveData() {
  localStorage.setItem('ordersData', JSON.stringify(data));
}

function calculateOrderPrice(operations) {
  const rates = {
    "–†–∞—Å–ø–∏–ª": 65, "–õ–∏–Ω–µ–π–Ω—ã–π": 26, "–°–∫–ª–µ–π–∫–∞ –ø—Ä–æ—Å—Ç–∞—è": 165,
    "–°–∫–ª–µ–π–∫–∞ —Å –æ–±–≥–æ–Ω–æ–º": 210, "–§—Ä–µ–∑–µ—Ä —Ñ–∞—Å–∫–∏": 16, "–ü–∞–∑–æ–≤–∫–∞": 30, "–í—Ä–µ–º—è": 330
  };
  let total = 0;
  operations.forEach(op => {
    const qty = op.quantity || 1;
    if (["–†–∞—Å–ø–∏–ª", "–°–∫–ª–µ–π–∫–∞ –ø—Ä–æ—Å—Ç–∞—è", "–°–∫–ª–µ–π–∫–∞ —Å –æ–±–≥–æ–Ω–æ–º"].includes(op.type)) {
      total += op.m2 * rates[op.type] * qty;
    }
    if (["–õ–∏–Ω–µ–π–Ω—ã–π", "–§—Ä–µ–∑–µ—Ä —Ñ–∞—Å–∫–∏", "–ü–∞–∑–æ–≤–∫–∞"].includes(op.type)) {
      total += op.pm * rates[op.type] * qty;
    }
    if (op.type === "–í—Ä–µ–º—è") {
      total += op.time * rates[op.type] * qty;
    }
  });
  return Math.round(total * 100) / 100;
}

function loadMainScreen() {
  let total = 0;
  let today = new Date().toISOString().split('T')[0];
  let daily = 0;

  data.orders.forEach(order => {
    if (order.status === 'closed') {
      const price = order.price || calculateOrderPrice(order.operations || []);
      total += price;
      if (order.date === today) daily += price;
    }
  });

  document.getElementById("totalEarnings").textContent = `${Math.round(total * 100)/100}‚ÇΩ`;
  document.getElementById("dailyEarnings").textContent = `${Math.round(daily * 100)/100}‚ÇΩ`;
}

// === –ö–ù–û–ü–ö–ò ===
document.getElementById("btnOrders").onclick = () => {
  alert("–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ ‚Äî –ø–æ–∫–∞ –ø—É—Å—Ç–æ–π");
};

document.getElementById("btnShifts").onclick = () => {
  const date = prompt("–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É (–ì–ì–ì–ì-–ú–ú-–î–î):", new Date().toISOString().split('T')[0]);
  if (!date) return;
  const orders = data.orders.filter(o => o.date === date);
  let text = `–ó–∞–∫–∞–∑—ã –∑–∞ ${date}:\n`;
  if (orders.length === 0) text += "–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤";
  else {
    orders.forEach(o => {
      text += `\n‚Ññ${o.id}: ${o.detail || '-'} ‚Äî ${o.status}`;
    });
  }
  alert(text);
};

// === –ê–í–ê–¢–ê–†–ö–ê ‚Üí –ü–õ–ê–ù ===
document.getElementById("avatarBtn").onclick = () => {
  const today = new Date().toISOString().split('T')[0];
  let daily = 0;
  data.orders.forEach(o => {
    if (o.status === 'closed' && o.date === today) {
      daily += o.price || calculateOrderPrice(o.operations || []);
    }
  });
  daily = Math.round(daily * 100) / 100;
  alert(`–ó–∞ —Å–µ–≥–æ–¥–Ω—è: ${daily}‚ÇΩ\n–ü–ª–∞–Ω: 3000‚ÇΩ`);
};

// –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
loadMainScreen();
</script>

</body>
</html>
